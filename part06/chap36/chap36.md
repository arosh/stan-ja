## 36.変分推定

Stanは，自動微分変分推定(ADVI)(Kucukelbir et al.,2015)と呼ばれる自動変分推定アルゴリズムを搭載しています。この章では，ADVIがどのようにして変分目標を最大化するのか，その特徴を論じます。よりハイレベルな説明は，32章を見てください。

### 36.1 確率的な勾配の上昇

ADVIは，確率的な勾配の上昇を利用して，実座標空間中のELBOを最適化します。ノイズの多い(しかしバイアスのない)，変分対象の勾配を，自動差分とモンテカルロ積分を使って手に入れます。アルゴリズムは，適応的ステップサイズのシークエンスによって，この勾配を上昇させます。我々はモンテカルロ積分を使ってELBOを評価し，Stanの最適化アルゴリズムと同じ相対的許容範囲をみて収束の程度を計ります。

#### ELBOのモンテカルロ近似

ADVIはモンテカルロ積分を使って，変分目的関数であるELBOを近似します。ELBOの近似に使うサンプル数は，`elbo_samples`で表されます。我々が推薦するデフォルトの値は100です。すべての`eval_elbo`反復についてELBOを評価するときでも，デフォルトは100です。

#### 勾配のモンテカルロ近似

ADVIはモンテカルロ積分を使って，ELBOの勾配を近似します。勾配の近似に使うサンプル数は，`grad_samples`で表されます。我々が推薦するデフォルトの値は1で，これは最も効果的な数値だからです。非常にノイズの多い推定ではありますが，確率的勾配の上昇はそんな勾配でも有効です。

#### 適応的ステップサイズのシークエンス

ADVIは，adaGrad(Duchi et al.,2011)の有限メモリバージョンを使います。これは1パラメータで，我々はこれを`eta` で表します。今はウオームアップ適応フェイズを使って，`eta`の良い値を選択することにしています。ここでは，5桁の`eta`値に及ぶヒューリステイック・サーチをしています。

#### 収束の判定

ADVIは，確率的最適化の中で，ELBOの経過を追いかけています。特に，ADVIはELBO変化量の平均と中央値を計算し，流れる文字列をヒューリスティックに止めます。どちらかの数値が`tol_rel_obj`で示される閾値を下回ったとき，このアルゴリズムは収束したと考えます。ELBOの変化は，Stanの最適化モジュールと同じ方法で計算しています。

