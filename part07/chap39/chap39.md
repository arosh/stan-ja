## 39. 整数値の基本関数

この章では，様々な引数を取り，整数値を返すStanの組み込み関数について記述しています。

### 39.1 整数値の計算演算子

Stanの演算は，標準的な倍精度のC++整数値と浮動小数点演算に基づいています。計算演算子に与えられる引数がいずれも整数，例えば`2+2`であれば，整数として計算されます。もし片方の引数が整数で，他方が浮動小数点を持つ値，例えば`2.0+2`や`2+2.0`であれば，整数値は浮動小数点を持つ値に格上げされ，浮動小数点の計算が行われます。

整数の計算の振る舞いは，浮動小数点の計算とは少し異なる振る舞いをします。まず違うのは，オーバーフローの扱いです。もし二つの整数値の和や積の計算が整数で表現できる最大値を超えたら，ビットのレベルで望ましくない丸め込みが生じます。Stanでは，オーバーフローをするかどうかのフラグをたてるチェックはしませんので，このようなことが起こらないようにするのはユーザーの責任になります。

次に，整数値のセットは割り算について閉じておらず，また整数値について特別な無限大の値というのはないので，整数の割り算は暗黙のうちに結果を丸めることになります。もし両方の引数が正の値であれば，結果は下に丸められます。例えば`1/2`は`0`になりますし，`5/3`は`1`と評価されます。

もし負の整数を引数にして割るのであれば，最新のC++の式は(C++11)，小数点をゼロになるように丸めるようとします。例えば`-1/2`は`0`と評価されますし，`-7/2`は`3`となります。C++11以前の式では，小数点を繰り上げるか繰り下げるかは，プラットフォームに依存しています。Stanのテンプレートを扱うことができるコンパイラは全て，C++11の特性を許容していますが，負の整数の割り算を使うかどうかわからない場合は，テストしたほうが良いでしょう。

`1.0/0.0`が特別に正の無限大を返すような浮動小数点の割り算と違って，`1/0`のような整数の割り算は，標準的なC++では定義されない振る舞いになります。例えばMac　OS　Xのコンパイラclang++では3764を返しますし，g++コンパイラは例外処理に投げて警告とともにプログラムが停止します。オーバーフローの時のように，整数を0で割るようなことがないようにするのはユーザーの責任になります。

#### バイナリ中置演算子

演算子はC++シンタックスを使って記述されます。例えば，`X+Y`と書く加法のバイナリ演算子は，Stanの書き方では`int operator+(int,int)`とし，二つの実引数が実数値を返すことを表します。

```
int operator+(int x, int y)
```

`x`と`y`を足した合計です。
$$ operator+(x,y) = (x+y) $$

```
int operator-(int x, int y)
```

引かれる数`x`と引く数`y`の差を表します。
$$ operator-(x,y) = (x-y) $$

```
int operator*(int x, int y)
```

因子`x`と`y`の積です。

$$ operator*(x,y) = (x \times y) $$

```
int operator/(int x, int y)
```

割られる数`x`と割る数`y`の商の整数です。

$$ operator/(x,y) = [x/y]$$

```
int operator%(int x, int y)
```

`x`の`y`の剰余とは，`x`を`y`で割った余りです。

$$ operator%(x,y) = x mod y = x - y * [x/y] $$

##### 一変量前置き演算子

```
int operator-(int x)
```

減数`x`の否定です。
$$ operator-(x)=-x $$

```
int operator+(int x)
```

処理しません。
$$ operator+(x)=x$$


### 39.2 絶対値関数

```
R abs(T x)
```

値`x`の(要素ごとの)絶対値を返します。
$$ abs(x) = |x| $$

これは引数の型Tが何であっても構いません。R型の戻り値も含む詳細はセクション40.1を参照。

```
int int_step(int x)
int int_step(real x)
```
整数のstepあるいは関数`x`のヘビサイドを返します。

$$
int\_step(x) = \left\{ \begin{array}{ll}
  0 & \text{$x \le 0$のとき} \\
  1 & \text{$x \gt 0$のとき}
  \end{array}
\right .
$$

データ以外のものにstep関数を適用することの危険性については，セクション40.7の注意をみてください。

### 39.3 境界を示す関数

```
int min(int x, int y)
```

`x`と`y`の小さい方の値を返します。

$$
min(x,y) = \left\{ \begin{array}{ll}
  x & \text{if $x<y$} \\
  y & \text{それ以外}
  \end{array}
\right .
$$


```
int max(int x, int y)
```

`x`と`y`の大きい方の値を返します。

$$
max(x,y) = \left\{ \begin{array}{ll}
  x & \text{if $x>y$} \\
  y & \text{それ以外}
  \end{array}
\right .
$$
